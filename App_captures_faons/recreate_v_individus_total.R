
dbSendQuery(con,paste0("

DROP VIEW public.v_individus_total;

CREATE OR REPLACE VIEW public.v_individus_total
AS
SELECT t_animal_ani.ani_id,
t_animal_ani.ani_etiq,
t_animal_ani.ani_name,
t_rfid_rfi.rfi_tag_code,
t_capture_cap.cap_bague,
t_capture_cap.cap_annee_suivi,
t_capture_cap.cap_date,
t_animal_ani.ani_sexe,
t_capture_cap.cap_age_classe,
t_capture_cap.cap_poids,
t_capture_cap.cap_lpa,
tr_site_capture_sit.sit_nom_court,
tr_type_equipement_teq.teq_nom_court,
t_equipement_eqt.eqt_id_usuel,
tr_eqtmarque_mar.mar_libelle,
tr_eqtmodel_mod.mod_libelle,
tj_equipement_animal_eqt_ani_eqa.eqa_date_debut,
tj_equipement_animal_eqt_ani_eqa.eqa_date_fin,
t_animal_ani.ani_mere_observee,
t_animal_ani.ani_mere_pedigree,
t_animal_ani.ani_pere_pedigree,
t_animal_ani.ani_fratrie,
t_animal_ani.ani_fratrie_oct,
t_animal_ani.ani_surv_faon_marque_oct,
t_animal_ani.ani_agres_faon_marque,
t_animal_ani.ani_mortalite,
t_animal_ani.ani_date_mort,
t_animal_ani.ani_cause_mort,
t_animal_ani.ani_cause_mort_classes,
tj_equipement_animal_eqt_ani_eqa.eqa_activite,
tj_equipement_animal_eqt_ani_eqa.eqa_probleme,
tj_equipement_animal_eqt_ani_eqa.eqa_date_fin_text,
tj_equipement_animal_eqt_ani_eqa.eqa_date_fin_arrondi,
t_animal_ani.ani_date_mort_arrondi,
t_animal_ani.ani_date_mort_text,
t_animal_ani.ani_poids_mort,
t_animal_ani.ani_poids_mort_na,
t_animal_ani.ani_lpa_mort,
t_animal_ani.ani_remarque,
t_animal_ani.ani_mort_x,
t_animal_ani.ani_mort_y,
t_animal_ani.ani_inconnu,
t_capture_cap.cap_faon,
t_capture_cap.cap_age,
t_capture_cap.cap_age_corrige,
t_capture_cap.cap_circou,
t_capture_cap.cap_etat_sante,
t_capture_cap.cap_heure_lacher,
tr_site_capture_sit.sit_id,
tr_sensors_sen.sen_association,
t_equipement_conf_eqc.eqc_couleur_boitier,
t_equipement_conf_eqc.eqc_couleur_collier,
t_equipement_conf_eqc.eqc_memoire,
t_equipement_conf_eqc.eqc_remarque,
t_capture_cpt.cpt_nom_capteur,
t_capture_cpt.cpt_nbre_pers_experimentes,
t_capture_cpt.cpt_arrivee_filet_course,
t_capture_cpt.cpt_arrivee_filet_panique,
t_capture_cpt.cpt_filet_lutte,
t_capture_cpt.cpt_filet_haletement,
t_capture_cpt.cpt_filet_cri,
t_capture_cpt.cpt_dose_acepromazine,
t_capture_cpt.cpt_sabot_couche,
t_capture_cpt.cpt_sabot_agitation,
t_capture_cpt.cpt_sabot_retournement,
t_capture_cpt.cpt_hre_fin_surv,
t_capture_cpt.cpt_temps_surveillance_mn,
t_capture_cpt.cpt_distance_km,
t_capture_cpt.cpt_tble_lutte,
t_capture_cpt.cpt_tble_halete,
t_capture_cpt.cpt_tble_cri_synthese,
t_capture_cpt.cpt_tble_cri_bague,
t_capture_cpt.cpt_tble_cri_autre,
t_capture_cpt.cpt_tble_temp_animal,
t_capture_cpt.cpt_tble_temp_exterieur,
t_capture_cpt.cpt_tble_coeur,
t_capture_cpt.cpt_tble_remise_sabot,
t_capture_cpt.cpt_table_eurodeer,
t_capture_cpt.cpt_lache_titube,
t_capture_cpt.cpt_lache_couche,
t_capture_cpt.cpt_lache_course,
t_capture_cpt.cpt_lache_tombe,
t_capture_cpt.cpt_lache_gratte_collier,
t_capture_cpt.cpt_lache_cabriole,
t_capture_cpt.cpt_lache_bolide,
t_capture_cpt.cpt_lache_aboiement_cri,
t_capture_cpt.cpt_lache_nbre_stop,
t_capture_cpt.cpt_lache_habitat_lache,
t_capture_cpt.cpt_lache_habitat_pertevue,
t_capture_cpt.cpt_lache_visibilite,
t_capture_cpt.cpt_lache_public,
t_capture_cpt.cpt_lache_eurodeer,
t_capture_cpt.cpt_temps_filet,
t_capture_cpt.cpt_temps_sabot_sur_place,
t_capture_cpt.cpt_temps_transport_attente,
t_capture_cpt.cpt_temps_marquage,
t_capture_cpt.cpt_temps_total,
t_capture_cpt.cpt_heure_debut_filet,
t_capture_cpt.cpt_heure_mise_sabot,
t_capture_cpt.cpt_heure_acepro,
t_capture_cpt.cpt_heure_debut_transport,
t_capture_cpt.cpt_heure_debut_table,
t_capture_cpt.cpt_heure_lache,
t_capture_cpt.cpt_heure_second_lache,
t_capture_cpt.cpt_remarque,
t_capture_cpt.cpt_cap_id,
t_capture_cpt.cpt_tble_ventilation,
avant_capture_actif, 
avant_capture_cri, 
avant_capture_etat_faon, 
avant_capture_faon_visible, 
avant_capture_gite, 
avant_capture_cri_detresse, 
avant_capture_mere_gite, 
avant_capture_mere_vis, 
avant_capture_position_init, 
avant_capture_reaction, 
capture, 
capture_cri, 
pesee_agitation, 
entre_manip_agitation, 
entre_manip_cri, 
apres_lacher_latence, 
apres_lacher_activite, 
apres_lacher_comportement, 
apres_lacher_parti, 
apres_lacher_vocalise,
t_para_expar.adhs_dilution_neospora_caninum,
t_para_expar.adhs_dilution_toxoplasma_gondii,
t_para_expar.adhs_titre_neospora_caninum,
t_para_expar.adhs_titre_toxoplasma_gondii,
t_para_expar.babesia_digestion_clai_hinfi_babesia_capreoli,
t_para_expar.babesia_digestion_clai_hinfi_babesia_venatorum,
t_para_expar.babesia_pcr_babesia,
t_para_expar.babesia_sequence_babesia_capreoli,
t_para_expar.bartonella_schoenbuchensi_bacteraemia_bartonella_schoenbuchensi,
t_para_expar.bartonella_schoenbuchensi_boleen_bartonella_schoenbuchensis,
t_para_expar.brucellose_pcr_brucella_abortus,
t_para_expar.btv_elisa_blue_tongue_virus_btv,
t_para_expar.bvdv_elisa_bovine_viral_diarrhea_virus_bvdv,
t_para_expar.caev_elisa_caprine_arthritis_encephalitis_virus_caev_maed_visna,
t_para_expar.capillaria_capillaria,
t_para_expar.capillaria_nematoda,
t_para_expar.chlamydia_pcr_ecvag_chlamydiaceae,
t_para_expar.chlamydia_pcr_feces_chlamydiaceae,
t_para_expar.chlamydia_pcr_num_chlamydiaceae,
t_para_expar.chlamydia_pcr_serum_chlamydiaceae,
t_para_expar.chlamydia_pcr_serum_chlamydia_pecorum,
t_para_expar.chlamydia_pcr_serum_chlamydia_psittaci,
t_para_expar.chlamydia_pcr_serum_chlamydia_suis,
t_para_expar.chlamydia_pcr_serum_chlamydophila_abortus,
t_para_expar.chlamydophila_elisa_chlamydophila_abortus,
t_para_expar.coccidies_boleen_coccidia,
t_para_expar.coccidies_quantitatif_coccidia,
t_para_expar.coccidies_quantitatif_plus_coccidia,
t_para_expar.dicrocoelium_lanceolatum_dicrocoelium_lanceolatum,
t_para_expar.dictyocaules_dictyocaulus,
t_para_expar.echinostomida_echinostomida,
t_para_expar.elisa_anti_borreliella_borrelia_ssp,
t_para_expar.fievreq_elisa_coxiella_burnetii,
t_para_expar.fievreq_pcr_coxiella_burnetii,
t_para_expar.gene_18s_babesia_bigemina,
t_para_expar.gene_18s_babesia_canis_subsp_canis,
t_para_expar.gene_18s_babesia_ovis,
t_para_expar.gene_18s_babesia_venatorum,
t_para_expar.gene_18s_theileria_annulata,
t_para_expar.gene_23s_borrelia_spp,
t_para_expar.gene_btq_bartonella_quintana,
t_para_expar.gene_ccteta_babesia_bovis,
t_para_expar.gene_ccteta_babesia_major,
t_para_expar.gene_ccteta_babesia_microti,
t_para_expar.gene_dsb_ehrlichia_chaffeensis,
t_para_expar.gene_dsb_ehrlichia_ruminantium,
t_para_expar.gene_ema1r2_theileria_equi,
t_para_expar.gene_fla_borrelia_afzelii,
t_para_expar.gene_fla_borrelia_spielmanii,
t_para_expar.gene_fopa_francisella_tularensis,
t_para_expar.gene_glpq_borrelia_miyamotoi,
t_para_expar.gene_glta_rickettsia_spotted_fever_group,
t_para_expar.gene_groel_anaplasma_bovis,
t_para_expar.gene_groel_anaplasma_centrale,
t_para_expar.gene_groel_anaplasma_platys,
t_para_expar.gene_groel_candidatus_neoehrlichia_mikurensis,
t_para_expar.gene_hsp70_babesia_canis_subsp_vogeli,
t_para_expar.gene_hsp70_babesia_divergens_ou_babesia_capreoli,
t_para_expar.gene_icd_coxiella_burnetii,
t_para_expar.gene_is1111_coxiella_burnetii,
t_para_expar.gene_its_rickettsia_aeschlimannii,
t_para_expar.gene_its_rickettsia_conorii,
t_para_expar.gene_its_rickettsia_helvetica,
t_para_expar.gene_its_rickettsia_massiliae,
t_para_expar.gene_its_rickettsia_slovaca,
t_para_expar.gene_msp1_anaplasma_marginale,
t_para_expar.gene_msp2_anaplasma_phagocytophilum,
t_para_expar.gene_msp4_anaplasma_ovis,
t_para_expar.gene_ospa_borrelia_valaisiana,
t_para_expar.gene_pap31_bartonella_henselae,
t_para_expar.gene_rap1_babesia_caballi,
t_para_expar.gene_rpob_borrelia_bissettii,
t_para_expar.gene_rpob_borrelia_burgdorferi_sensu_stricto,
t_para_expar.gene_rpob_borrelia_garinii,
t_para_expar.gene_rpob_borrelia_lusitaniae,
t_para_expar.gene_tul4_francisella_tularensis,
t_para_expar.haemonchus_contortus_haemonchus_contortus,
t_para_expar.ibr_elisa_infectious_bovine_rhinotracheitis_ibr_bovine_herpesvi,
t_para_expar.moniezia_boleen_moniezia,
t_para_expar.moniezia_quantitatif_moniezia,
t_para_expar.moniezia_quantitatif_plus_moniezia,
t_para_expar.mycoplasma_elisa_mycoplasma_agalactiae,
t_para_expar.nematodirus_nematodirus,
t_para_expar.neospora_elisa_neospora_caninum,
t_para_expar.oxyures_oxyuris,
t_para_expar.paratub_elisa_mycobacterium_avium_subsp_paratuberculosis,
t_para_expar.recomline_chlamydia_chlamydia_pneumoniae,
t_para_expar.recomline_chlamydia_chlamydia_psittaci,
t_para_expar.recomline_chlamydia_chlamydia_trachomatis,
t_para_expar.salmonella_seroagglutination_salmonella_enterica_subsp_enterica,
t_para_expar.schmallenberg_elisa_schmallenberg_virus,
t_para_expar.strongles_gastro_intestinaux_strongylida,
t_para_expar.strongles_tot_secernentea,
t_para_expar.strongyloides_strongyloidea,
t_para_expar.strongyloides_strongyloides_papillosus,
t_para_expar.ticks_count_ixodida,
t_para_expar.tiques_ixodida,
t_para_expar.toxo_elisa_toxoplasma_gondii,
t_para_expar.trichure_trichuris_ovis,
t_para_expar.trichurides_tot_trichuridae,
t_para_expar.expar_cap_id,
t_phy_exphy.albumine_concentration,
t_phy_exphy.albumine_percent,
t_phy_exphy.azote_fecale,
t_phy_exphy.b12,
t_phy_exphy.carbone_fecale,
t_phy_exphy.cayman_cortisol_elisa_kit,
t_phy_exphy.cayman_cortisol_elisa_kit_duplicate,
t_phy_exphy.cayman_cortisol_elisa_kit_mean,
t_phy_exphy.concentration_corpusculaire_en_hgb_mchc,
t_phy_exphy.creatinine,
t_phy_exphy.creatinine_kinase,
t_phy_exphy.differential_white_blood_cell_count,
t_phy_exphy.fecal_glucocorticoid_metabolites,
t_phy_exphy.fibrinogene,
t_phy_exphy.fructosamine,
t_phy_exphy.globule_blanc_wbc,
t_phy_exphy.globule_rouge_rbc,
t_phy_exphy.globuline,
t_phy_exphy.globuline_alpha1_concentration,
t_phy_exphy.globuline_alpha1_percent,
t_phy_exphy.globuline_alpha2_concentration,
t_phy_exphy.globuline_alpha2_percent,
t_phy_exphy.globuline_beta_concentration,
t_phy_exphy.globuline_beta_percent,
t_phy_exphy.globuline_gamma_concentration,
t_phy_exphy.globuline_gamma_percent,
t_phy_exphy.gluco_corticoid_07_08,
t_phy_exphy.gluco_corticoid_10_11,
t_phy_exphy.glucose_blood,
t_phy_exphy.gnb_granulocyte_basophile,
t_phy_exphy.gnb_granulocyte_basophile_total,
t_phy_exphy.gne_granulocyte_eosinophile,
t_phy_exphy.gne_granulocyte_eosinophile_total,
t_phy_exphy.gnn_granulocyte_basophil,
t_phy_exphy.gnn_granulocyte_basophil_auto,
t_phy_exphy.gnn_granulocyte_basophil_count,
t_phy_exphy.gnn_granulocyte_eosinophil,
t_phy_exphy.gnn_granulocyte_eosinophil_count,
t_phy_exphy.gnn_granulocyte_neutrophile,
t_phy_exphy.gnn_granulocyte_neutrophile_total,
t_phy_exphy.hemagglutination_ha,
t_phy_exphy.hematocrite_hct,
t_phy_exphy.hemoglobine_hgb,
t_phy_exphy.hemolysis_hl,
t_phy_exphy.high_fluorescence_reticulocyte,
t_phy_exphy.immature_reticulocyte_fraction,
t_phy_exphy.low_fluorescence_reticulocyte,
t_phy_exphy.lymphocyte,
t_phy_exphy.lymphocyte_total,
t_phy_exphy.mean_platelet_volume,
t_phy_exphy.microhematocrites_percent,
t_phy_exphy.middle_fluorescence_reticulocyte,
t_phy_exphy.monocytes,
t_phy_exphy.monocyte_total,
t_phy_exphy.phosphore_fecale,
t_phy_exphy.plaquette_comptage_plt_o,
t_phy_exphy.plaquette_impedance_plt,
t_phy_exphy.platelet_crit,
t_phy_exphy.platelet_distribution_width,
t_phy_exphy.platelet_larger_cell_ratio,
t_phy_exphy.proteine_totale,
t_phy_exphy.ratio_albumine_globuline,
t_phy_exphy.red_blood_cell_hemoglobin_equivalent,
t_phy_exphy.red_cell_distribution_width,
t_phy_exphy.red_cell_distribution_width_percent,
t_phy_exphy.remark_formule_sanguine,
t_phy_exphy.reticulocyte_count,
t_phy_exphy.reticulocyte_hemoglobin_equivalent,
t_phy_exphy.reticulocyte_rate,
t_phy_exphy.t4,
t_phy_exphy.taux_corpusculaire_moyen_mch,
t_phy_exphy.texture_feces,
t_phy_exphy.uree,
t_phy_exphy.volume_globulaire_moyen_mcv,
t_phy_exphy.exphy_cap_id,
t_animal_ani.ani_cause_fin_suivi,
t_animal_ani.ani_cause_fin_suivi_remarque,
t_animal_ani.ani_date_fin_suivi,
t_animal_ani.ani_date_fin_suivi_text,
t_animal_ani.ani_necropsie,
t_animal_ani.ani_crane,
t_animal_ani.ani_remarque_suivi,
t_animal_ani.ani_dernier_contact,
t_capture_cap.cap_proximite_contact,
t_capture_cap.cap_pertinent,
t_capture_cap.cap_num_sabot,
cap_tag_droit,
cap_tag_droit_metal,
cap_tag_gauche,
cap_tag_gauche_metal,
cap_age_faon,
cap_telemetrie,
cap_date_fin_capteur,
cap_ect_id,
cap_ecl_id
FROM t_animal_ani
LEFT JOIN t_capture_cap ON t_capture_cap.cap_ani_id = t_animal_ani.ani_id
LEFT JOIN tj_equipement_animal_eqt_ani_eqa ON tj_equipement_animal_eqt_ani_eqa.eqa_ani_id = t_capture_cap.cap_ani_id AND tj_equipement_animal_eqt_ani_eqa.eqa_annee_suivi = t_capture_cap.cap_annee_suivi
LEFT JOIN t_equipement_eqt ON t_equipement_eqt.eqt_id = tj_equipement_animal_eqt_ani_eqa.eqa_eqt_id
LEFT JOIN tr_type_equipement_teq ON tr_type_equipement_teq.teq_id = t_equipement_eqt.eqt_teq_id
LEFT JOIN tr_site_capture_sit ON t_capture_cap.cap_sit_id = tr_site_capture_sit.sit_id
LEFT JOIN tr_eqtmarque_mar ON t_equipement_eqt.eqt_mar_id = tr_eqtmarque_mar.mar_id
LEFT JOIN tr_eqtmodel_mod ON t_equipement_eqt.eqt_mod_id = tr_eqtmodel_mod.mod_id
LEFT JOIN t_equipement_conf_eqc ON t_equipement_conf_eqc.eqc_eqt_id = t_equipement_eqt.eqt_id AND t_equipement_conf_eqc.eqc_annee_suivi = t_capture_cap.cap_annee_suivi
LEFT JOIN listes.tr_sensors_sen ON tr_sensors_sen.sen_id = t_equipement_conf_eqc.eqc_sen_id
LEFT JOIN cmpt.t_capture_cpt ON t_capture_cpt.cpt_cap_id = t_capture_cap.cap_id
LEFT JOIN cmpt.v_comportement_faons ON v_comportement_faons.cap_id = t_capture_cap.cap_id
LEFT JOIN para_phy.t_para_expar ON t_para_expar.expar_cap_id = t_capture_cap.cap_id
LEFT JOIN para_phy.t_phy_exphy ON t_phy_exphy.exphy_cap_id = t_capture_cap.cap_id
LEFT JOIN t_rfid_rfi ON t_rfid_rfi.rfi_cap_id = t_capture_cap.cap_id
ORDER BY t_capture_cap.cap_annee_suivi, t_capture_cap.cap_date, t_animal_ani.ani_etiq;

ALTER TABLE public.v_individus_total
OWNER TO postgres;

GRANT ALL ON TABLE public.v_individus_total TO postgres;
GRANT ALL ON TABLE public.v_individus_total TO cefs;
GRANT ALL ON TABLE public.v_individus_total TO cefs_ecriture;
GRANT SELECT ON TABLE public.v_individus_total TO cefs_lecture;
GRANT ALL ON TABLE public.v_individus_total TO cefs_admin;"))



